<div class="overlay" [ngClass]="{ 'align-left': alignLeft }" (click)="onClose()">
  <div class="detail-panel" (click)="$event.stopPropagation()">
    <!-- Close button -->
    <button class="close-btn" (click)="onClose()">Ã—</button>

    <!-- Header -->
    <div class="header">
      <div class="date">{{ formattedDate }}</div>
      <div class="subtitle">Multiple classes scheduled</div>
    </div>

    <!-- Events list -->
    <div class="events-list">
      <div 
        class="event-row" 
        *ngFor="let ev of events">
        
        <!-- Important star per event -->
        <button 
          class="star-icon" 
          type="button"
          (click)="onToggleImportantFor(ev)">
          <svg *ngIf="!importantStates[ev.id]" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <svg *ngIf="importantStates[ev.id]" width="20" height="20" viewBox="0 0 24 24" fill="#FFD700">
            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
          </svg>
        </button>

        <div class="event-icon-large">
          <ng-container *ngIf="ev.title === 'Python'; else multiIconText">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQNghUjM5ct10-zw9HdcDhmh4uohnyHQ7caHQ&s" alt="Python logo" />
          </ng-container>
          <ng-template #multiIconText>
            {{ ev.icon || 'ðŸ“š' }}
          </ng-template>
        </div>

        <div class="event-info">
          <div class="event-title">{{ ev.title }}</div>
          <div class="event-time">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
            </svg>
            {{ ev.startTime }} - {{ ev.endTime }}
          </div>
          <div class="event-description" *ngIf="ev.description">
            {{ ev.description }}
          </div>

          <!-- Teacher section -->
          <div class="teacher-section" *ngIf="ev.teacher">
            <div class="label">Teacher:</div>
            <div class="teacher-info">
              <div class="avatar">{{ ev.teacher.name.charAt(0) }}</div>
              <span>{{ ev.teacher.name }}</span>
            </div>
          </div>

          <!-- Note section per event -->
          <div class="note-section">
            <div class="note-label-row">
              <label>Note:</label>
              <button 
                *ngIf="isNoteSaved[ev.id] && !isNoteEditable[ev.id]" 
                class="edit-note-btn" 
                type="button"
                (click)="onEditNoteFor(ev)"
                title="Edit note">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
            </div>
            <textarea
              [(ngModel)]="noteTexts[ev.id]"
              [readonly]="!isNoteEditable[ev.id]"
              rows="3"
              placeholder="Add your notes here...">
            </textarea>
            <button 
              *ngIf="isNoteEditable[ev.id]" 
              class="save-note-btn" 
              type="button"
              (click)="onSaveNoteFor(ev)">
              Save Note
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
